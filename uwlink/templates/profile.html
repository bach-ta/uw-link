{% extends "base.html" %}
{% block head %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='profile.css') }}">
<style>
body  {
  background-image: url('/static/acount-background.jpeg');
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-position: center;
  background-size: 100% 100%;
}
</style>
{% endblock %}
{% block page_content %}
<div class="content-section">
  <div class="media">
    <div class="media-body">
      <h1 class="account-heading">{{ name }}</h1>
      <p class="text-secondary">{{ email }}</p>
      <legend class = "text-secondary"> </legend>
    </div>
  </div>
  <fieldset class="form-group">
    <div class="events_info">
      <h2 class="title">Events Created</h2>
      {% for event in events_created %}
        <div class="card">
          <h2 class="name">{{event.name}}</h2>
          <p class="description">{{event.description}}</p>
          <div class="line">
            <div class="time">
              <b>Time: </b>
              {{event.time.strftime('%Y-%m-%d %H:%M')}}
            </div>
            <div class="creator">
              <b>Created by: </b>
              <a href="{{ url_for('api.profile', username=event.creator) }}">{{event.creator}}</a>
            </div>
          </div>
          <div class="participants">
            {% if event.participants|length > 0 %}
              <b>Participants: </b>
              {% for participant in event.participants %}
                <a href="{{ url_for('api.profile', username=participant) }}">{{participant}}</a>
              {% endfor %}
            {% else %}
              No participants. Be the first to join this event!
            {% endif %}
          </div>
          {% set event_id = event.id|string() %}
          {% if user %}
            {% if event_id in user.events_created %}
              <form action="{{ url_for('api.delete') }}" method="post">
                <input type="hidden" name="event_id" value={{ event_id|safe }}>
                <input class="btn" type="submit" name="form_data" value="Delete">
              </form>
            {% elif event_id not in user.events_joined %}
              <form action="{{ url_for('api.join') }}" method="post">
                <input type="hidden" name="event_id" value={{ event_id|safe }}>
                <input class="btn" type="submit" name="form_data" value="&nbsp Join &nbsp">
              </form>
            {% else %}
              <form action="{{ url_for('api.leave') }}" method="post">
                <input type="hidden" name="event_id" value={{ event_id|safe }}>
                <input style="background-image: linear-gradient(to left, #e97777, #ceacb4);" class="btn" type="submit" name="form_data" value="&#8201 Leave">
              </form>
            {% endif %}
          {% else %}
            <form action="{{ url_for('api.login') }}" method="post">
              <input type="hidden" name="event_id" value={{ event_id|safe }}>
              <input class="btn" type="submit" name="form_data" value="&nbsp Join &nbsp">
            </form>
          {% endif %}
        </div>
      {% endfor %}
    </div>
    <div class="events_info">
      <h2 class="title">Events Joined</h2>
      {% for event in events_joined %}
        <div class="card">
          <h2 class="name">{{event.name}}</h2>
          <p class="description">{{event.description}}</p>
          <div class="line">
            <div class="time">
              <b>Time: </b>
              {{event.time.strftime('%Y-%m-%d %H:%M')}}
            </div>
            <div class="creator">
              <b>Created by: </b>
              <a href="{{ url_for('api.profile', username=event.creator) }}">{{event.creator}}</a>
            </div>
          </div>
          <div class="participants">
            {% if event.participants|length > 0 %}
              <b>Participants: </b>
              {% for participant in event.participants %}
                <a href="{{ url_for('api.profile', username=participant) }}">{{participant}}</a>
              {% endfor %}
            {% else %}
              No participants. Be the first to join this event!
            {% endif %}
          </div>
          {% set event_id = event.id|string() %}
          {% if user %}
            {% if event_id in user.events_created %}
              <form action="{{ url_for('api.delete') }}" method="post">
                <input type="hidden" name="event_id" value={{ event_id|safe }}>
                <input class="btn" type="submit" name="form_data" value="Delete">
              </form>
            {% elif event_id not in user.events_joined %}
              <form action="{{ url_for('api.join') }}" method="post">
                <input type="hidden" name="event_id" value={{ event_id|safe }}>
                <input class="btn" type="submit" name="form_data" value="&nbsp Join &nbsp">
              </form>
            {% else %}
              <form action="{{ url_for('api.leave') }}" method="post">
                <input type="hidden" name="event_id" value={{ event_id|safe }}>
                <input style="background-image: linear-gradient(to left, #e97777, #ceacb4);" class="btn" type="submit" name="form_data" value="&#8201 Leave">
              </form>
            {% endif %}
          {% else %}
            <form action="{{ url_for('api.login') }}" method="post">
              <input type="hidden" name="event_id" value={{ event_id|safe }}>
              <input class="btn" type="submit" name="form_data" value="&nbsp Join &nbsp">
            </form>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </fieldset>
</div>

<div class="page-bottom">
  {% if page_count > 1 %}
    <ul class="pagination">
      {% if account %}
        {% if page > 1 %} 
          <li><a href="{{url_for('api.account', page=page-1) }}" class="butn btn-outline-dark">&laquo;</a></li>
        {% else %}
          <li><a class="page-no-link disabled" href="#/" >&laquo;</a></li>
        {% endif %}
        {% for page_number in range(1, page_count + 1) %}
          {% if page_number == page %}
            <li class="active"><a href="{{ url_for('api.account', page=page_number) }}">{{ page_number }} </a></li>
          {% else %}
            <li><a href="{{ url_for('api.account', page=page_number) }}">{{ page_number }}</a></li>
          {% endif %}
        {% endfor %}
        {% if page < page_count %}
          <li><a href="{{url_for('api.account', page=page+1) }}" class="butn btn-outline-dark">&raquo;</a></li>
        {% else %}
          <li><a class="page-no-link disabled" href="#/" >&raquo;</a></li>
        {% endif %}
      {% else %}
        {% if page > 1 %} 
          <li><a href="{{url_for('api.profile', username=name, page=page-1) }}" class="butn btn-outline-dark">&laquo;</a></li>
        {% else %}
          <li><a class="page-no-link disabled" href="#/" >&laquo;</a></li>
        {% endif %}
        {% for page_number in range(1, page_count + 1) %}
          {% if page_number == page %}
            <li class="active"><a href="{{ url_for('api.profile', username=name, page=page_number) }}">{{ page_number }} </a></li>
          {% else %}
            <li><a href="{{ url_for('api.profile', username=name, page=page_number) }}">{{ page_number }}</a></li>
          {% endif %}
        {% endfor %}
        {% if page < page_count %}
          <li><a href="{{url_for('api.profile', username=name, page=page+1) }}" class="butn btn-outline-dark">&raquo;</a></li>
        {% else %}
          <li><a class="page-no-link disabled" href="#/" >&raquo;</a></li>
        {% endif %}
      {% endif %}
    </ul>
    <div class="text-bottom">
      Showing page {{ page }} of {{ page_count }}
    </div>
  {% else %}
    <div class="text-bottom">
     Showing page 1 of 1
    </div>
  {% endif %}
</div>
{% endblock page_content %}
